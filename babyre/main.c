//
// Created by explorer on 17-5-18.
//


#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "numCalc.h"
#include "rsa.h"
//unsigned int enFlag[] = {0xfe6a752b,0xbcc9ec0,0x1fe693d4,0xb2a41d17,0xc80e3d02,0x393dc7da,0x3980927e,0x33c703f1,0xc4c77be2,0x685cd5fc,0x3c111193,0x1b8452a4,0x6d607337,0x35614ccb,0xa18c44be,0x1021cf5f,0x9c2ec7a0,0x28c3ff9c,0x4439437a,0x9ae5c601,0xf03b1ede,0x5b3a2ed,0x1b8735b,0x878c4c99,0xda5657ba,0xc990c9f,0x7b887d86,0xf89aa4a2,0xdb268bd5,0x22e4b716,0x754c052c,0x1f4ef426,0xcf4871ec,0x40ba1d51,0x431c7002,0x9139d4c0,0x19ddffed,0x1a685a3b,0x5139feeb,0xf1e9a357,0x8436d04e,0x3f2e195,0x37117911,0x79e44b5d,0x43199e07,0xfc0dbe34,0x500066e3,0x248e2289,0x8be6e7b6,0xee9d312f,0x1c5cf444,0x6f8a8fb2,0x1607557f,0x4c5d7243,0x97c7a461,0xc59ede19,0x864fc2f6,0x38a9326e,0x97e061c9,0x99845219,0xe6448205,0xcc2b5ab7,0x9a609708,0x4701836b};
//N = 14666487342503083471807606312461723978240506638165849380623408579560506363615512247944740237037296771140488537728995975288589102039071393297769874805757279360901408676426948766451162604061203154137989064175425544484354651880623776367937781874343608036288822520874960952509774564726556242545280881687648043810854336305624794302707485593880983113077355205286443817915833159233123400618758050861638974090395522084572135667444325042085748712439764338325670931501969634756038765724891432691225072149523340985947514314391037628757601918113554449296134005884641772490187719123179514222560341014894182573800764974687118339119L
unsigned int N[] = {0x527aac2f,0xb7ed0c7f,0xe31cf08c,0xec7e2aa0,0xf42c3128,0x40470bf,0xaf363e7c,0xdd1e58ac,0x6cb3e33e,0xb73ed0c3,0x7c9bb570,0x868dabe,0xa6974c04,0x42802bc4,0x8fd2e74d,0x9d4c498b,0x7050f00f,0xf542dd72,0xe9d9f0e2,0x5501c47,0xf5b3c7a5,0x3951065c,0x814a5542,0xe8d559d7,0xb25ebcd7,0x7fdb3f7d,0x2c427f34,0x492d9203,0x83b4d9e9,0xb4460177,0xf6835d7b,0x381ef17a,0x37c0908,0xbf1ce99,0xc3db35e,0xb128f3ce,0xbb3082ce,0x15c6b38c,0xbc29e904,0x4f0a609,0xf4020f46,0x3f0f04d5,0x1a4e91b,0x80dc9489,0x1825c176,0x120ba8b7,0x5ebae678,0xd8a1e7c0,0xd1241eb8,0x1627875b,0x7e98c5fc,0x1fc279bf,0x277091aa,0x1ea51669,0x1aa87e71,0x18941f33,0x167ad134,0x9d439e4c,0x4dc050f8,0xa72eec32,0xca9d7dae,0xa44eefa7,0x6d86ea82,0x742e5355};

//char *e = "9173396248210066774791951287599061165176235666051417855411293663761853304933714749203645639720894727992485782896434306783485455210344672499037419936790233283978940354094998255231137748772317125328219063412758659412939404469497966241344611599112168260135172762228255954942470848688656006494192471413660455753905042332904701924282957696044171102792559313082355937143019500132951683959101881381633720281008254931498439321143957003085106215943931053007461838036459536327968216458206694370299215692043024858807218788617525820114672623451932001832294553149494990089478607617690685671104779905430420700185189156923603457097";
unsigned int e[] = {0xef49449,0x99a996cd,0xc16ad69c,0x4aa21003,0x7d04bb13,0x16966f7c,0xe84e9d5f,0x32c83ce5,0x83a3424a,0x3eb003c0,0x73fe7e64,0x16ab54ed,0xab94d950,0x31960c60,0xd83a344b,0x46679522,0x57a15ac9,0x79a3c0ee,0xdcf29ddb,0x75545208,0xef7e6be8,0xe7a24112,0xf23034c7,0x8afa5be5,0x6b0b9d40,0xe0b31136,0x7d6285c3,0x93004fe3,0x573ea32e,0x3ed457d0,0xa1b7ba86,0x73e560fb,0xf4185e8e,0x89a29be8,0xa7c61120,0xde35e747,0xd9a2d82d,0x8e76441a,0xdd303daf,0xeaa3b744,0x4fbc79cb,0x973c2f2c,0x493da2de,0x56f67b6e,0x9a3fde5,0x279ee953,0xf081a3a0,0xb5fb1cf4,0x7eb4489,0xa061811e,0x4c6e7c92,0xeecc3a56,0xdb6d158f,0xc22d9df2,0x3b9cdefc,0x5f17c6d9,0x160f11c5,0x7ea1481c,0x4997c7aa,0xf728b5c7,0xd464ca8e,0x83481db8,0xc4163a06,0x48aad3e5};
//char *dd ="1755492484105943047562086282537430722047263832296085767755238882716304964045794503979448081844137980948080237698678038074121272832999427341042139714470620782682274073918974361947879991029603886889888303560325010376302360491010724141716113061624843130550605276933223876178951183807030147758053759941704583624548508349247446321225137030907523122063559150574875083000239317010798840625056888186524649044310619562939597223492607158242644564128013314341828926962933863021400703037493076284112459821778174863425900417708129376355817238996017424172879545138513618410876377962756976649491358420270310926701146717282189239626";
//char *d = "9521171633217865745054397571218410585988132847527668882058143182543050698321533266610642972565313889188160804087857282104231258686050447144008665832101033";
// flag: flag{this is a test flag}
int main(void){
    char flag[100];
    char *n,*m;
    unsigned int *en;
    bigInteger *f,*bN,*be,*re;
    intergerNode *p;
    int length,size,i,j;
    fgets(flag, 100, stdin);
    length = (int) strlen(flag);
    flag[length-1] = 0;
    length--;
    size = length/4 + (length%4==0?1:0);

    n = malloc((size_t) (size * 4));
    memset(n, 0, (size_t) (size * 4));
    memcpy(n+(4-length%4), flag, (size_t) length);

    m = n + size*4-1;
    f = createBigInteger();
    f->next = (intergerNode *) f;
    f->prev = (intergerNode *) f;
    for(i=0;i<size;i++){
        p = createIntergerNode();

        for(j=0;j<4;j++){
            p->num |= *m << (8*j);
            m--;
        }

        p->prev = f->prev;
        p->next = (struct intergerNode *) f;
        f->prev->next = p;
        f->prev = p;
        f->size++;
    }

    bN = arrayToNum(N, sizeof(N)/4);

    be = arrayToNum(e, sizeof(N)/4);

    re = modPow(f, be, bN);
    en = malloc(re->size * 4);
    printNum(re);
//    for(p = re->next,i=0; p != (intergerNode *) re; p=p->next,i++){
//        en[i] = p->num;
//    }
//    if(!memcmp(en, enFlag, re->size*4)){
//        puts("true");
//    } else{
//        puts("error");
//    }

}
